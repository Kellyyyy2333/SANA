#include <cassert>
#include <utility>
#include "NormalMode.hpp"
#include "../utils/utils.hpp"
#include "../arguments/measureSelector.hpp"
#include "../arguments/methodSelector.hpp"
#include "../arguments/GraphLoader.hpp"
#include "../report.hpp"
#include <iostream>

void NormalMode::run(ArgumentParser& args) {
    createFolders();
    pair<Graph, Graph> graphs = GraphLoader::initGraphs(args);
    Graph G1 = graphs.first;
    Graph G2 = graphs.second;

    MeasureCombination M;
    measureSelector::initMeasures(M, G1, G2, args); 
    Method* method;
    method = methodSelector::initMethod(G1, G2, args, M);
    Alignment A = method->runAndPrintTime();
    A.printDefinitionErrors(G1,G2);
    assert(A.isCorrectlyDefined(G1, G2) and "Resulting alignment is not correctly defined");

    bool shortReport = false; // for multiPairwiseIteration
    if(args.bools["-multi-iteration-only"]) shortReport = true;

    report::saveReport(G1, G2, A, M, method, args.strings["-o"], shortReport);
    report::saveLocalMeasures(G1, G2, A, M, method, args.strings["-localScoresFile"]);
    delete method;
}

string NormalMode::getName() { return "NormalMode"; }

void NormalMode::createFolders() {
    createFolder("matrices"); //are all these still used? -Nil
    createFolder("tmp");
    createFolder("alignments");
    createFolder("go");
    createFolder("go/autogenerated");
    createFolder("networks");
    createFolder(AUTOGENEREATED_FILES_FOLDER);
}
