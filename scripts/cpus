#!/bin/sh
(lscpu | awk '/^CPU[(s)]*:/{print $NF}') 2>/dev/null && exit
([ `arch` = Darwin -o `uname` = Darwin ] || uname -a | grep Darwin >/dev/null) && sysctl -n hw.ncpu && exit
case `arch` in
CYGWIN*) grep -c '^processor[ 	]*:' /proc/cpuinfo ;;
*) [ -d /dev/cpu -a ! -f /dev/cpu/microcode ] && ls -F /dev/cpu | fgrep -c / && exit;;
esac
echo "couldn't figure out number of CPUs" >&2; exit 1

